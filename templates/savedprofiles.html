<!DOCTYPE html>
<html>
<head>
    <title>DMT 14C: Data acquisition software - Saved profiles</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{{ url_for('static', filename='dist/css/output.css') }}" rel="stylesheet">
    <style>

@import url("https://fonts.googleapis.com/css?family=Lato:300");
            *, *::before, *::after {
            box-sizing: border-box;
            }
            
        :root {
            --primary-color: #191970;
            --secondary-color: #1E90FF;
            --background-color: #000000;
            --text-color: #FFFFFF;
        }

        body {
            background: linear-gradient(0deg, #1c4872, #000000);
            color: var(--text-color);
            background-repeat: no-repeat;
            font-family: "Lato", sans-serif;
            margin: 0;
            padding: 0;
            margin-left: 10px;
            margin-right: 10px;
        }


    h1 {
    font-family: 'Lato';
    }

    p {
    font-family:'Lato';
    }


        .bg-blue-900 {
            background-color: var(--primary-color);
        }

        .text-slate-50 {
            color: var(--text-color);
        }

        .p-3 {
            padding: 0.75rem;
        }

        .text-3xl {
            font-size: 1.875rem;
        }

        .font-bold {
            font-weight: bold;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .ml-4 {
            margin-left: 1rem;
        }

        .mt-5 {
            margin-top: 1.25rem;
        }

        .mb-3 {
            margin-bottom: 0.75rem;
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .ml-4 {
            margin-left: 1rem;
        }

        .mb-3 {
            margin-bottom: 0.75rem;
        }
        .saved-profiles-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    grid-gap: 16px;
    padding: 10px;
    border-radius: 5px;

}

.saved-profile {
  background-color: #FFFFFF;
  border-radius: 12px;
  padding: 10px;
  box-shadow: 0 0 0 2px #1E90FF; /* Add an outline glow */
  transition: box-shadow 0.3s, background-color 0.3s;
  color: #000000; /* Set the text color to black */
}

.saved-profile:hover {
  box-shadow: 0 0 10px rgba(30, 144, 255, 0.5); /* Adjust the shadow color for the hover effect */
  background-color: #E2ECF6; /* Change the background color on hover */
}

.saved-profile.clicked {
  box-shadow: 0 0 20px rgba(30, 144, 255, 0.8); /* Adjust the shadow color for the clicked effect */
}

    .profile-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .profile-name {
        font-size: 20px;
        font-weight: bold;
    }

    .button {
        display: inline-block;
            padding: 15px 20px;
            background-color: var(--secondary-color);
            color: var(--text-color);
            font-weight: bold;
            text-decoration: none;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
            transition: box-shadow 0.3s;
            margin-bottom: 20px;
            margin-left:  10px;
    }

    .button-group {
        display: flex;
        gap: 8px;
    }

    .expand-button,
    .delete-button {
        background-color: transparent;
        border: none;
        cursor: pointer;
        font-size: 24px;
    }

    .expand-button {
        color: #5ddf0d;
    }

    .delete-button {
        color: red;
    }

    .profile-details {
        display: none;
        margin-top: 12px;
    }

    .title {
        font-size: 24px;
        font-weight: bold;
        text-align: center;
        margin: 20px 0;
    }

    </style>
</head>
<body>
    <div>
        <h1 class="title">SAVED PROFILES</h1>
        <button class="button" onclick="window.location.href='/'">&#8249; Back to main page</button>
        </div>
    </div>

    <div>
        <div class="saved-profiles-container">
            {% for profile in profiles %}
            <div class="saved-profile">
                <div class="profile-header">
                    <span class="profile-name">{{ profile.name }}</span>
                    <div class="button-group">
                        <button class="expand-button" onclick="toggleProfileDetails(event)">
                            &#9660;
                        </button>
                        <button class="delete-button" onclick="deleteProfile('{{ profile.name }}')">
                            &#10006;
                        </button>
                    </div>
                </div>
                <div class="profile-details">
                    <p><strong>Duty Cycle:</strong> {{ profile.duty_cycle }}</p>
                    <p><strong>Current:</strong> {{ profile.current }}</p>
                    <p><strong>Speed:</strong> {{ profile.speed }}</p>
                    <p><strong>Ramp Down Speed:</strong> {{ profile.ramp_down_speed }}</p>
                    <p><strong>Ramp Up Speed:</strong> {{ profile.ramp_up_speed }}</p>
                    <p><strong>Linear Actuator Position:</strong> {{ profile.linear_actuator }}</p>
                    <p><strong>Rotary Motor Position:</strong> {{ profile.rotary_motor }}</p>
                    <p><strong>VESC Port:</strong> {{ profile.vesc_port }}</p>
                    <p><strong>Arduino Port:</strong> {{ profile.arduino_port }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        
    </div>

    <script>
        let expandedProfile = null;

function toggleProfileDetails(event) {
    const button = event.target;
    const profile = button.parentNode.parentNode;
    const profileDetails = profile.querySelector('.profile-details');
    const expandButton = profile.querySelector('.expand-button');

    if (expandedProfile !== null && expandedProfile !== profile) {
        // Collapse the previously expanded profile
        const previousProfileDetails = expandedProfile.querySelector('.profile-details');
        const previousExpandButton = expandedProfile.querySelector('.expand-button');  // Get the expand button of the previously expanded profile
        previousProfileDetails.style.display = 'none';
        previousExpandButton.innerHTML = '&#9660;';
    }

    profileDetails.style.display = profileDetails.style.display === 'none' ? 'block' : 'none';
    expandButton.innerHTML = profileDetails.style.display === 'none' ? '&#9660;' : '&#9650;';

    expandedProfile = profile;
}
        function deleteProfile(profileName) {
        const confirmation = confirm(`Are you sure you want to delete profile "${profileName}"?`);
        if (confirmation) {
            // Perform deletion logic here
            const requestOptions = {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ profileName }),
            };

            fetch('/delete_profile', requestOptions)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Profile deleted successfully, refresh the page or update the UI
                        location.reload(); // Refresh the page
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    }
    
    const profileItems = document.querySelectorAll('.saved-profile');
    profileItems.forEach(item => {
        item.addEventListener('click', () => {
            const profileDetails = item.querySelector('.profile-details');
            const expandButton = item.querySelector('.expand-button');
            profileDetails.style.display = profileDetails.style.display === 'none' ? 'block' : 'none';
            expandButton.innerHTML = profileDetails.style.display === 'none' ? '&#9660;' : '&#9650;';
        });
    });

        // Pass the profile names to the parent window (index.html)
        const profileNames = Array.from(profileItems, item => item.querySelector('.profile-name').textContent);
        window.opener.receiveProfileNames(profileNames);

        // Receive the profile names from the server
        receiveProfiles({{ profiles | tojson }});

    </script>
</body>
</html>
